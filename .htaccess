# ==================================================
# ОСНОВНЫЕ НАСТРОЙКИ
# ==================================================

AddDefaultCharset UTF-8
Options -Indexes

# ==================================================
# MIME TYPES (favicon, svg, manifest)
# ==================================================

AddType image/x-icon .ico
AddType image/png .png
AddType image/svg+xml .svg
AddType application/manifest+json .webmanifest

# ==================================================
# REWRITE ENGINE
# ==================================================

RewriteEngine On

# ==================================================
# CANONICAL: HTTPS + DOMAIN (БЕЗ www)
# ==================================================

RewriteCond %{HTTPS} !=on [OR]
RewriteCond %{HTTP_HOST} !^planetum\.by$ [NC]
RewriteRule ^(.*)$ https://planetum.by/$1 [R=301,L]

# ==================================================
# УБИРАЕМ index.html (ГЛАВНАЯ ПРОБЛЕМА GSC)
# ==================================================

RewriteCond %{THE_REQUEST} \s/+(.*/)?index\.html[\s?] [NC]
RewriteRule ^(.*/)?index\.html$ https://planetum.by/$1 [R=301,L]

# ==================================================
# TRAILING SLASH ТОЛЬКО ДЛЯ РЕАЛЬНЫХ ДИРЕКТОРИЙ
# ==================================================

RewriteCond %{REQUEST_FILENAME} -d
RewriteCond %{REQUEST_URI} !/$
RewriteRule ^(.+)$ https://planetum.by/$1/ [R=301,L]

# ==================================================
# КЭШИРОВАНИЕ (УСКОРЕНИЕ САЙТА)
# ==================================================

<IfModule mod_expires.c>
  ExpiresActive On

  ExpiresByType text/html "access plus 1 hour"

  ExpiresByType text/css "access plus 30 days"
  ExpiresByType application/javascript "access plus 30 days"
  ExpiresByType text/javascript "access plus 30 days"

  ExpiresByType image/jpg "access plus 90 days"
  ExpiresByType image/jpeg "access plus 90 days"
  ExpiresByType image/png "access plus 90 days"
  ExpiresByType image/gif "access plus 90 days"
  ExpiresByType image/svg+xml "access plus 90 days"
  ExpiresByType image/webp "access plus 90 days"

  ExpiresByType font/woff "access plus 180 days"
  ExpiresByType font/woff2 "access plus 180 days"
</IfModule>

# ==================================================
# GZIP СЖАТИЕ
# ==================================================

<IfModule mod_deflate.c>
  AddOutputFilterByType DEFLATE text/plain
  AddOutputFilterByType DEFLATE text/html
  AddOutputFilterByType DEFLATE text/css
  AddOutputFilterByType DEFLATE application/javascript
  AddOutputFilterByType DEFLATE text/javascript
  AddOutputFilterByType DEFLATE application/json
  AddOutputFilterByType DEFLATE image/svg+xml
</IfModule>

# ==================================================
# SECURITY HEADERS
# ==================================================

<IfModule mod_headers.c>
  Header always set X-Content-Type-Options "nosniff"
  Header always set X-Frame-Options "SAMEORIGIN"
  Header always set X-XSS-Protection "1; mode=block"
  Header always set Referrer-Policy "strict-origin-when-cross-origin"
</IfModule>

# ==================================================
# 404 PAGE
# ==================================================

ErrorDocument 404 /404.html
